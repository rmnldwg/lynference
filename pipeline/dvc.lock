schema: '2.0'
stages:
  join:
    cmd: "lyscripts data join --inputs data/2023-clb-multisite.csv data/2023-isb-multisite.csv
      --output data/joined.csv\n"
    deps:
    - path: data/2023-clb-multisite.csv
      hash: md5
      md5: 9d72ee96af2c51033a2fb0bb8551e318
      size: 123938
    - path: data/2023-isb-multisite.csv
      hash: md5
      md5: 3de3a3d4238148e1b4e5f813e83d4c80
      size: 205012
    outs:
    - path: data/joined.csv
      hash: md5
      md5: b8e5e1fb297b7afea644206c4e2098b9
      size: 386471
  enhance:
    cmd: "lyscripts data enhance data/joined.csv data/enhanced.csv --modalities CT
      MRI PET FNA diagnostic_consensus pathology pCT\n"
    deps:
    - path: data/joined.csv
      hash: md5
      md5: b8e5e1fb297b7afea644206c4e2098b9
      size: 386471
    params:
      params.yaml:
        modalities:
          CT:
          - 0.76
          - 0.81
          MRI:
          - 0.63
          - 0.81
          PET:
          - 0.86
          - 0.79
          FNA:
          - 0.98
          - 0.8
          diagnostic_consensus:
          - 0.86
          - 0.81
          pathology:
          - 1.0
          - 1.0
          pCT:
          - 0.86
          - 0.81
          max_llh:
          - 1.0
          - 1.0
    outs:
    - path: data/enhanced.csv
      hash: md5
      md5: 79ee2a07804565b82bc113d37c9d6334
      size: 483692
  clean:
    cmd: lyscripts data clean data/filtered.csv data/cleaned.csv
    deps:
    - path: data/filtered.csv
      hash: md5
      md5: 907c8a72f5eb7cfee4d041a82da1def3
      size: 166037
    params:
      params.yaml:
        model.class: MidlineBilateral
    outs:
    - path: data/cleaned.csv
      hash: md5
      md5: 1a40ed6909f8f0bf9dcd74ed1dd9f34d
      size: 134066
  sampling:
    cmd: "lyscripts sample data/cleaned.csv models/samples.hdf5 --plots plots/sampling
      --modalities max_llh\n"
    deps:
    - path: data/cleaned.csv
      hash: md5
      md5: 1a40ed6909f8f0bf9dcd74ed1dd9f34d
      size: 134066
    params:
      params.yaml:
        graph:
          tumor:
            primary:
            - I
            - II
            - III
          lnl:
            I: []
            II:
            - I
            - III
            III: []
        modalities:
          CT:
          - 0.76
          - 0.81
          MRI:
          - 0.63
          - 0.81
          PET:
          - 0.86
          - 0.79
          FNA:
          - 0.98
          - 0.8
          diagnostic_consensus:
          - 0.86
          - 0.81
          pathology:
          - 1.0
          - 1.0
          pCT:
          - 0.86
          - 0.81
          max_llh:
          - 1.0
          - 1.0
        model:
          first_binom_prob: 0.3
          max_t: 10
          t_stages:
          - early
          - late
          class: MidlineBilateral
          kwargs:
            base_symmetric: false
            trans_symmetric: true
            evolve_midext: true
            use_mixing: true
        sampling:
          walkers_per_dim: 20
          burnin: 1000
          nsteps: 50
          thin_by: 5
          kwargs:
            max_steps: 20000
            check_interval: 100
            trust_threshold: 30.0
            rel_acor_threshold: 0.075
    outs:
    - path: models/samples.hdf5
      hash: md5
      md5: e9fe3cb37e8bdb234daa77947f99d1bf
      size: 3301440
    - path: plots/sampling/accept_rates.csv
      hash: md5
      md5: 1485505c83c686bf7cef828a9ec00b3f
      size: 1081
    - path: plots/sampling/acor_times.csv
      hash: md5
      md5: 2f46684c70bc3f30f6c8cc6dbec259e1
      size: 1052
  predict-risks:
    cmd: "lyscripts predict risks models/samples.hdf5 models/risks.hdf5\n"
    deps:
    - path: models/samples.hdf5
      md5: cf0603eb71eb87010494a1629f3c78ea
      size: 4839888
    params:
      params.yaml:
        graph:
          tumor:
            primary:
            - I
            - II
            - III
            - IV
            - V
            - VII
          lnl:
            I: []
            II:
            - I
            - III
            - V
            III:
            - IV
            - V
            IV: []
            V: []
            VII: []
        model:
          first_binom_prob: 0.3
          max_t: 10
          t_stages:
          - early
          - late
          class: MidlineBilateral
          kwargs:
            base_symmetric: false
            trans_symmetric: true
            use_mixing: true
        risks:
        - name: contra/III/N0/late/ext
          involvement:
            contra:
              III: true
          given_diagnosis:
            ipsi:
              I: false
              II: false
              III: false
              IV: false
              V: false
              VII: false
            contra:
              I: false
              II: false
              III: false
              IV: false
              V: false
              VII: false
          given_diagnosis_spsn:
          - 0.76
          - 0.81
          t_stage: late
          midline_extension: true
        - name: contra/III/ipsi-IIandIII/late/noext
          involvement:
            contra:
              III: true
          given_diagnosis:
            ipsi:
              I: false
              II: true
              III: true
              IV: false
              V: false
              VII: false
            contra:
              I: false
              II: false
              III: false
              IV: false
              V: false
              VII: false
          given_diagnosis_spsn:
          - 0.76
          - 0.81
          t_stage: late
          midline_extension: false
        - name: contra/III/ipsi-IIandIII/late/ext
          involvement:
            contra:
              III: true
          given_diagnosis:
            ipsi:
              I: false
              II: true
              III: true
              IV: false
              V: false
              VII: false
            contra:
              I: false
              II: false
              III: false
              IV: false
              V: false
              VII: false
          given_diagnosis_spsn:
          - 0.76
          - 0.81
          t_stage: late
          midline_extension: true
    outs:
    - path: models/risks.hdf5
      md5: 482530636158d86338279d278b63ae87
      size: 470280
  evaluate:
    cmd: "lyscripts evaluate data/cleaned.csv models/samples.hdf5 --metrics metrics.json\n"
    deps:
    - path: data/cleaned.csv
      hash: md5
      md5: 1a40ed6909f8f0bf9dcd74ed1dd9f34d
      size: 134066
    - path: models/samples.hdf5
      hash: md5
      md5: e9fe3cb37e8bdb234daa77947f99d1bf
      size: 3301440
    params:
      params.yaml:
        graph:
          tumor:
            primary:
            - I
            - II
            - III
          lnl:
            I: []
            II:
            - I
            - III
            III: []
        modalities:
          CT:
          - 0.76
          - 0.81
          MRI:
          - 0.63
          - 0.81
          PET:
          - 0.86
          - 0.79
          FNA:
          - 0.98
          - 0.8
          diagnostic_consensus:
          - 0.86
          - 0.81
          pathology:
          - 1.0
          - 1.0
          pCT:
          - 0.86
          - 0.81
          max_llh:
          - 1.0
          - 1.0
        model:
          first_binom_prob: 0.3
          max_t: 10
          t_stages:
          - early
          - late
          class: MidlineBilateral
          kwargs:
            base_symmetric: false
            trans_symmetric: true
            evolve_midext: true
            use_mixing: true
        sampling:
          walkers_per_dim: 20
          burnin: 1000
          nsteps: 50
          thin_by: 5
          kwargs:
            max_steps: 20000
            check_interval: 100
            trust_threshold: 30.0
            rel_acor_threshold: 0.075
    outs:
    - path: metrics.json
      hash: md5
      md5: 470b458c5741132d6921511c248ef584
      size: 92
  predict-prevalences:
    cmd: "lyscripts predict prevalences models/samples.hdf5 data/cleaned.csv models/prevalences.hdf5\n"
    deps:
    - path: data/cleaned.csv
      md5: 4c6ec4376c1d6ca3814a17a61305c89b
      size: 300071
    - path: models/samples.hdf5
      md5: cf0603eb71eb87010494a1629f3c78ea
      size: 4839888
    params:
      params.yaml:
        graph:
          tumor:
            primary:
            - I
            - II
            - III
            - IV
            - V
            - VII
          lnl:
            I: []
            II:
            - I
            - III
            - V
            III:
            - IV
            - V
            IV: []
            V: []
            VII: []
        model:
          first_binom_prob: 0.3
          max_t: 10
          t_stages:
          - early
          - late
          class: MidlineBilateral
          kwargs:
            base_symmetric: false
            trans_symmetric: true
            use_mixing: true
        prevalences:
        - name: ipsi/IInotI/early
          pattern:
            ipsi:
              I: false
              II: true
          modality: max_llh
          modality_spsn:
          - 1.0
          - 1.0
          t_stage: early
        - name: ipsi/IInotI/late
          pattern:
            ipsi:
              I: false
              II: true
          modality: max_llh
          modality_spsn:
          - 1.0
          - 1.0
          t_stage: late
        - name: ipsi/IIandIII/early
          pattern:
            ipsi:
              II: true
              III: true
          modality: max_llh
          modality_spsn:
          - 1.0
          - 1.0
          t_stage: early
        - name: ipsi/IIandIII/late
          pattern:
            ipsi:
              II: true
              III: true
          modality: max_llh
          modality_spsn:
          - 1.0
          - 1.0
          t_stage: late
    outs:
    - path: models/prevalences.hdf5
      md5: c0bef3861c2871034bcf3fd4de248e6e
      size: 619656
  plot-corner:
    cmd: "python scripts/plot_corner.py --samples models/samples.hdf5 --output plots/corner.png\n"
    deps:
    - path: models/samples.hdf5
      hash: md5
      md5: e9fe3cb37e8bdb234daa77947f99d1bf
      size: 3301440
    outs:
    - path: plots/corner.png
      hash: md5
      md5: 8b8c5b399edca9d427b844c9f6d8b363
      size: 1382301
    - path: plots/corner.svg
      hash: md5
      md5: 3bf59848b3546b3d0d799930dbcaa39f
      size: 5688089
  filter:
    cmd: python scripts/filter.py --input data/enhanced.csv --output data/filtered.csv
    deps:
    - path: data/enhanced.csv
      hash: md5
      md5: 79ee2a07804565b82bc113d37c9d6334
      size: 483692
    - path: scripts/filter.py
      hash: md5
      md5: 831ff029b0f6554022f6ac920d5e2ee9
      size: 1519
    outs:
    - path: data/filtered.csv
      hash: md5
      md5: 907c8a72f5eb7cfee4d041a82da1def3
      size: 166037
  comp-midext-ratio:
    cmd: "python scripts/comp_midext.py -m midext_ratios.json\n"
    deps:
    - path: models/samples.hdf5
      hash: md5
      md5: e9fe3cb37e8bdb234daa77947f99d1bf
      size: 3301440
    - path: scripts/comp_midext.py
      hash: md5
      md5: 68914b33780b3109bef4ed375f19c127
      size: 2051
    params:
      params.yaml:
        general:
          data: data/cleaned.csv
          samples: models/samples.hdf5
          risks: models/risks.hdf5
          prevalences: models/prevalences.hdf5
          metrics: metrics.json
          plots_dir: plots
        model:
          first_binom_prob: 0.3
          max_t: 10
          t_stages:
          - early
          - late
          class: MidlineBilateral
          kwargs:
            base_symmetric: false
            trans_symmetric: true
            evolve_midext: true
            use_mixing: true
    outs:
    - path: midext_ratios.json
      hash: md5
      md5: 3b4d0f471a0167e99d82d61ccc6d3de6
      size: 188
